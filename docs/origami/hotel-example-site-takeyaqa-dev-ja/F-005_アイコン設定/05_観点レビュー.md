# 観点レビュー: F-005 アイコン設定

## 生成情報

| 項目 | 内容 |
|------|------|
| 生成日時 | 2026-02-23 |
| 入力ソース | 04_テストケース.md, 01_機能詳細.md |
| 参照カタログ | テスト観点カタログ v1.6（TIS株式会社, CC BY-SA 4.0） |
| アプリ種別 | web |
| 対象機能 | F-005 アイコン設定 |
| 総観点数 | 25件（対象: 25件 / 対象外: 0件） |
| 信号分布 | 🟢 12件 / 🟡 9件 / 🔴 4件 |

---

## カバレッジサマリー

| セクション | 対象観点数 | 🟢 カバー済 | 🟡 未カバー推奨 | 🔴 要確認 | カバー率 |
|-----------|-----------|------------|----------------|----------|---------|
| バリデーション（VAL） | 8 | 6 | 2 | 0 | 75% |
| ウェブアプリケーション（WEB） | 6 | 3 | 3 | 0 | 50% |
| セキュリティ共通（SEC-C） | 5 | 1 | 2 | 2 | 20% |
| セキュリティウェブ（SEC-W） | 4 | 1 | 2 | 1 | 25% |
| ユーザビリティ（USA） | 2 | 1 | 0 | 1 | 50% |
| **合計** | **25** | **12** | **9** | **4** | **48%** |

---

## 🟢 カバー済み観点

| # | 観点ID | 観点名 | 対応テストケース | カテゴリ |
|---|--------|--------|----------------|---------|
| 1 | VP-VAL-001 | 最大値境界のバリデーション | TC-005-06（10KB境界）, TC-005-07（10KB+1byte） | バリデーション |
| 2 | VP-VAL-002 | 最小値境界のバリデーション | TC-005-04（1KB）, TC-005-23（0KB空ファイル） | バリデーション |
| 3 | VP-VAL-003 | 有効値の受け入れ | TC-005-04, TC-005-05, TC-005-10, TC-005-11 | バリデーション |
| 4 | VP-VAL-004 | 無効値の拒否 | TC-005-07, TC-005-08, TC-005-09, TC-005-12 | バリデーション |
| 5 | VP-VAL-006 | ファイル形式バリデーション | TC-005-10（JPEG）, TC-005-11（PNG）, TC-005-12（TXT拒否） | バリデーション |
| 6 | VP-VAL-008 | エラー時のフォーム継続利用 | TC-005-07（ファイル拒否後も操作継続可能と推測） | バリデーション |
| 7 | VP-WEB-001 | ページタイトルの正確性 | TC-005-01 | ウェブアプリ |
| 8 | VP-WEB-002 | ナビゲーション動作 | TC-005-02, TC-005-19, TC-005-20 | ウェブアプリ |
| 9 | VP-WEB-004 | フォームの基本動作 | TC-005-03（UI要素表示）, TC-005-18（確定ボタン） | ウェブアプリ |
| 10 | VP-SEC-C-001 | アクセス制御 | TC-005-21（新規ユーザーのみアクセス可）, TC-005-22（事前ユーザー不可） | セキュリティ共通 |
| 11 | VP-SEC-W-001 | ファイルアップロードの制限 | TC-005-07〜TC-005-09（サイズ制限）, TC-005-12（形式制限） | セキュリティウェブ |
| 12 | VP-USA-001 | エラーメッセージの明確性 | TC-005-07, TC-005-08, TC-005-09（エラー表示確認） | ユーザビリティ |

---

## 🟡 未カバー推奨観点

| # | 観点ID | 観点名 | 推奨理由 | カテゴリ |
|---|--------|--------|---------|---------|
| 1 | VP-VAL-007 | ファイルサイズの単位解釈 | 「10KB」が1000バイト(SI)か1024バイト(二進)かで境界値が異なる可能性がある。ファイルアップロード機能で重要な検証観点 | バリデーション |
| 2 | VP-VAL-009 | 複数ファイル選択時の動作 | ファイルアップロードUIで複数ファイルを選択しようとした場合の動作（1ファイルのみ受付等）を確認すべき | バリデーション |
| 3 | VP-WEB-003 | ブラウザ間の互換性 | ファイルアップロード・Canvas/プレビュー動作はブラウザにより異なる可能性がある（Chrome/Firefox/Safari） | ウェブアプリ |
| 4 | VP-WEB-005 | 画像プレビューのレンダリング | スライダーや枠線設定変更後の描画タイミング・パフォーマンスをテストすべき観点（特に大きめの画像） | ウェブアプリ |
| 5 | VP-WEB-006 | ページリロード後のUI状態 | ページリロード時にアップロード済みの画像・スライダー値・枠線色の状態が初期化されるかを確認すべき | ウェブアプリ |
| 6 | VP-SEC-C-003 | セッション切れ時のアクセス制御 | 画像選択後にセッションが切れた状態で「確定」ボタンを押した場合の動作確認が必要 | セキュリティ共通 |
| 7 | VP-SEC-C-004 | Local Storage へのデータ保存 | 確定後にLocal Storageに保存される内容（画像データの形式・サイズ）の検証が必要 | セキュリティ共通 |
| 8 | VP-SEC-W-003 | 画像MIMEタイプの検証 | 拡張子を偽装したファイル（.jpgとして保存したテキスト）をアップロードした場合の動作確認が必要 | セキュリティウェブ |
| 9 | VP-SEC-W-004 | 悪意ある画像ファイル | 有効なJPEGヘッダを持つが内部に悪意あるコードが埋め込まれたファイルに対するバリデーション | セキュリティウェブ |

---

## 🔴 要確認観点

| # | 観点ID | 観点名 | 確認内容 | カテゴリ |
|---|--------|--------|---------|---------|
| 1 | VP-SEC-C-005 | 画像データのサニタイジング | アップロード画像に対してサーバーサイドでのサニタイジング処理が行われているかを確認する必要がある（クライアントサイドのみの場合は要確認） | セキュリティ共通 |
| 2 | VP-SEC-C-006 | CSRF対策 | 「確定」ボタンによる保存処理にCSRF対策が実装されているかを確認（フォーム送信があるためトークンの有無を確認） | セキュリティ共通 |
| 3 | VP-SEC-W-002 | XSSペイロードを含む画像ファイル名 | ファイル名にスクリプトタグを含む画像を選択した場合にXSSが発生しないかを確認（例: `<script>alert(1)</script>.jpg`） | セキュリティウェブ |
| 4 | VP-USA-002 | アクセシビリティ対応 | ファイルアップロードフィールド・スライダー・色選択UIに適切なaria属性・ラベルが付与されているかを確認（スクリーンリーダー対応） | ユーザビリティ |

---

## 補完テストケース案

🟡項目に対する補完テストケース案を以下に示します。

### STC-005-01: 10KBの単位解釈によるファイルサイズ境界の確認

| 項目 | 内容 |
|------|------|
| テストID | STC-005-01 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-VAL-007 |
| テスト種別 | 境界値 |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページを表示している
- ちょうど10,240バイト（10 × 1024バイト）のJPEGファイルを用意している

**When（実行条件）:**

1. ファイルアップロードフィールドで10,240バイトのJPEGファイルを選択する

**Then（期待結果）:**

- [ ] ファイルが受け入れられること（10KiBを「10KB」と解釈する場合）
- [ ] またはエラーが表示されること（10,000バイトを「10KB」と解釈する場合）

**根拠:** テスト観点カタログ VP-VAL-007（ファイルサイズの単位解釈）に基づく補完

---

### STC-005-02: ファイルアップロード後のページリロードで状態がリセットされること

| 項目 | 内容 |
|------|------|
| テストID | STC-005-02 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-WEB-006 |
| テスト種別 | 正常系 |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページに有効な画像をアップロードし、スライダーと枠線色を変更している

**When（実行条件）:**

1. ブラウザでページをリロード（F5）する

**Then（期待結果）:**

- [ ] ファイルアップロードフィールドがクリアされること
- [ ] スライダーが初期値に戻ること
- [ ] 枠線の色が初期値に戻ること
- [ ] プレビューがクリアされること（未確定の変更は保持されない）

**根拠:** テスト観点カタログ VP-WEB-006（ページリロード後のUI状態）に基づく補完

---

### STC-005-03: 拡張子を偽装したファイルのアップロード

| 項目 | 内容 |
|------|------|
| テストID | STC-005-03 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-SEC-W-003 |
| テスト種別 | 異常系（セキュリティ） |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページを表示している
- テキストファイルの中身を持つがファイル名が `test.jpg` のファイル（5KB以下）を用意している

**When（実行条件）:**

1. ファイルアップロードフィールドで偽装ファイルを選択する

**Then（期待結果）:**

- [ ] バリデーションエラーが表示されること（MIMEタイプによる検証を行う場合）
- [ ] またはファイルが拒否されること
- [ ] サイレントに受け入れてアイコンとして設定されないこと

**根拠:** テスト観点カタログ VP-SEC-W-003（MIMEタイプ検証）に基づく補完

---

### STC-005-04: セッション期限切れ後の「確定」ボタンクリック

| 項目 | 内容 |
|------|------|
| テストID | STC-005-04 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-SEC-C-003 |
| テスト種別 | 異常系（セキュリティ） |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページで画像をアップロード・設定済みである
- セッションが期限切れになっている（別タブでログアウト等）

**When（実行条件）:**

1. 「確定」ボタンをクリックする

**Then（期待結果）:**

- [ ] エラーメッセージが表示されること（不正な保存が成功しないこと）
- [ ] またはログインページへリダイレクトされること
- [ ] セッション切れ状態でアイコンデータがLocal Storageに書き込まれないこと（推測）

**根拠:** テスト観点カタログ VP-SEC-C-003（セッション切れ時のアクセス制御）に基づく補完

---

### STC-005-05: 複数ファイル選択時は1ファイルのみ処理されること

| 項目 | 内容 |
|------|------|
| テストID | STC-005-05 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-VAL-009 |
| テスト種別 | 正常系 |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページを表示している
- 複数の有効な画像ファイルを用意している

**When（実行条件）:**

1. ファイルアップロードフィールドで複数ファイルを同時に選択しようとする

**Then（期待結果）:**

- [ ] 1ファイルのみ選択可能な制限がかかること（multiple属性なしのinput想定）
- [ ] またはUIが複数選択を防止していること

**根拠:** テスト観点カタログ VP-VAL-009（複数ファイル選択時の動作）に基づく補完

---

### STC-005-06: Firefoxでのファイルアップロード・プレビュー動作の確認

| 項目 | 内容 |
|------|------|
| テストID | STC-005-06 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-WEB-003 |
| テスト種別 | ブラウザ互換性 |
| 信号 | 🟡 |

**Given（前提条件）:**

- Firefoxブラウザを使用している
- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページを表示している

**When（実行条件）:**

1. 有効なJPEG画像（5KB以下）をアップロードする
2. スライダーを操作する
3. 枠線の色を選択する
4. 「確定」ボタンをクリックする

**Then（期待結果）:**

- [ ] ファイルアップロードが成功すること
- [ ] プレビューが表示されること
- [ ] スライダー・枠線設定がプレビューに反映されること
- [ ] 確定後に保存されること

**根拠:** テスト観点カタログ VP-WEB-003（ブラウザ互換性）に基づく補完

---

### STC-005-07: Local Storageへの保存内容の確認

| 項目 | 内容 |
|------|------|
| テストID | STC-005-07 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-SEC-C-004 |
| テスト種別 | 正常系（データ検証） |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページで画像・スライダー・枠線色を設定している

**When（実行条件）:**

1. 「確定」ボタンをクリックする
2. ブラウザのDevToolsでLocal Storageの内容を確認する

**Then（期待結果）:**

- [ ] アイコン設定データがLocal Storageに保存されること
- [ ] 保存形式が適切であること（例: Base64画像データ、スライダー値、枠線色）
- [ ] 不必要に大きなデータが保存されていないこと（例: 10KB超の生バイナリ）

**根拠:** テスト観点カタログ VP-SEC-C-004（Local Storageへのデータ保存）に基づく補完

---

### STC-005-08: 大きな画像のプレビュー描画パフォーマンス

| 項目 | 内容 |
|------|------|
| テストID | STC-005-08 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-WEB-005 |
| テスト種別 | 性能系 |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページに有効な画像（サイズ上限に近い10KB）をアップロード済みである

**When（実行条件）:**

1. スライダーを素早く端から端まで動かす
2. 枠線の色を素早く切り替える

**Then（期待結果）:**

- [ ] プレビューが遅延なく（またはユーザーが許容できる範囲で）更新されること
- [ ] UIがフリーズしないこと

**根拠:** テスト観点カタログ VP-WEB-005（画像プレビューのレンダリング）に基づく補完

---

### STC-005-09: ファイル名にXSSペイロードを含む画像ファイルの選択

| 項目 | 内容 |
|------|------|
| テストID | STC-005-09 |
| 対象機能 | F-005: アイコン設定 |
| 対応観点 | VP-SEC-W-002 |
| テスト種別 | 異常系（セキュリティ） |
| 信号 | 🔴 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- アイコン設定ページを表示している
- ファイル名が `<script>alert(1)</script>.jpg` または類似した名前の有効な画像ファイルを用意している

**When（実行条件）:**

1. ファイルアップロードフィールドでXSSペイロードを含むファイル名の画像を選択する
2. 「確定」ボタンをクリックする

**Then（期待結果）:**

- [ ] スクリプトが実行されないこと
- [ ] ファイル名が適切にエスケープされて表示されること
- [ ] XSSが成立しないこと

**根拠:** テスト観点カタログ VP-SEC-W-002（XSSペイロードを含むファイル名）に基づく補完
※ 🔴: ファイル名の画面表示有無・処理方法が仕様書に明示なく、実装確認必要

---

## 優先対応一覧

| # | 観点ID | 観点名 | 対応方針 | 信号 |
|---|--------|--------|---------|------|
| 1 | VP-SEC-W-002 | XSSペイロードを含むファイル名 | 🔴 ステークホルダー確認 → 実装確認後にSTC-005-09で検証 | 🔴 |
| 2 | VP-SEC-C-005 | 画像データのサニタイジング | 🔴 ステークホルダー確認（サーバーサイド処理有無の確認） | 🔴 |
| 3 | VP-SEC-C-006 | CSRF対策 | 🔴 ステークホルダー確認（保存処理のCSRFトークン確認） | 🔴 |
| 4 | VP-USA-002 | アクセシビリティ対応 | 🔴 ステークホルダー確認（スライダー・色選択UIのaria属性確認） | 🔴 |
| 5 | VP-SEC-W-003 | 拡張子偽装ファイルのMIMEタイプ検証 | 補完テストケース案あり（STC-005-03） | 🟡 |
| 6 | VP-SEC-C-003 | セッション切れ時のアクセス制御 | 補完テストケース案あり（STC-005-04） | 🟡 |
| 7 | VP-VAL-007 | ファイルサイズの単位解釈（KiB vs KB） | 補完テストケース案あり（STC-005-01） | 🟡 |
| 8 | VP-SEC-C-004 | Local Storageへの保存内容の検証 | 補完テストケース案あり（STC-005-07） | 🟡 |
| 9 | VP-WEB-003 | ブラウザ互換性 | 補完テストケース案あり（STC-005-06） | 🟡 |

---

## 参照カタログ情報

- **原典**: テスト観点カタログ v1.6
- **著作者**: TIS株式会社
- **ライセンス**: CC BY-SA 4.0 (Creative Commons Attribution-ShareAlike 4.0 International)
- **抽出範囲**: ブラックボックステスト関連項目（5セクション）
- **適用セクション**: VAL（バリデーション）/ WEB（ウェブアプリケーション）/ SEC-C（セキュリティ共通）/ SEC-W（セキュリティウェブ）/ USA（ユーザビリティ）

---

## 次のステップ

### 補完テストケースの反映

🟡項目の補完テストケース案を既存のテストケースに反映するには:

1. **手動追記**: `04_テストケース.md` に STC-005-01〜STC-005-08 をコピーして追記
2. **再生成**: 動作仕様（`02_動作仕様.md`）に該当観点を追加した上で `/origami:generate-cases` を再実行

### 確認事項

- 🔴項目（VP-SEC-W-002, VP-SEC-C-005, VP-SEC-C-006, VP-USA-002）についてステークホルダーに確認
- 特にファイルアップロード機能のサーバーサイド処理（サニタイジング・CSRF対策）の実装有無を確認
- 拡張子偽装・XSSペイロード対策はこのサイトがテスト練習用であることを踏まえて優先度を判断
- カバレッジ目標（推奨: 🟢 70%以上）に対して現状48% → 🟡補完ケース実施で75%以上が見込める
