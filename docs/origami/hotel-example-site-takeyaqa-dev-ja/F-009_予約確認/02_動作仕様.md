# F-009 予約確認 動作仕様

## 基本情報

| 項目 | 内容 |
|------|------|
| 機能ID | F-009 |
| 機能名 | 予約確認 |
| 入力ファイル | 01_機能詳細.md |

---

## Must（できなければならない）

### M-001: ページ表示

| No | 項目 | 信頼性 |
|----|------|--------|
| M-001-01 | ページタイトルが「宿泊予約確認 \| HOTEL PLANISPHERE - テスト自動化練習サイト」であること | 🟢 |
| M-001-02 | ページ読み込み時に sessionStorage（transactionCookieキー）から予約データを取得して各フィールドに表示すること | 🟢 |
| M-001-03 | ページ読み込み時に `transaction` Cookie を即座に削除すること（max-age=0） | 🟢 |
| M-001-04 | ページ読み込み時に sessionStorage の予約データを即座に削除すること | 🟢 |

### M-002: 予約サマリー表示

| No | 項目 | 信頼性 |
|----|------|--------|
| M-002-01 | 合計金額（h3#total-bill）が「合計 {金額}円（税込み）」の形式で表示されること | 🟢 |
| M-002-02 | プラン名（h4#plan-name）が表示されること | 🟢 |
| M-002-03 | プラン説明（p#plan-desc）が「お一人様1泊{金額}円〜、土日は25%アップ」の形式で表示されること | 🟢 |

### M-003: 詳細項目表示

| No | 項目 | 信頼性 |
|----|------|--------|
| M-003-01 | 期間（#term）が「{チェックイン年月日} 〜 {チェックアウト年月日} {泊数}泊」の形式で表示されること | 🟢 |
| M-003-02 | 人数（#head-count）が「{人数}名様」の形式で表示されること | 🟢 |
| M-003-03 | 追加プランが選択されている場合、#plans に `<ul><li>プラン名</li>...</ul>` の形式で表示されること | 🟢 |
| M-003-04 | 追加プランが選択されていない場合、#plans に「なし」と表示されること | 🟢 |
| M-003-05 | お名前（#username）が「{氏名}様」の形式で表示されること | 🟢 |
| M-003-06 | 確認のご連絡（#contact）が「希望しない」と表示されること（contact="no"の場合） | 🟢 |
| M-003-07 | 確認のご連絡（#contact）が「メール：{メールアドレス}」の形式で表示されること（contact="email"の場合） | 🟢 |
| M-003-08 | 確認のご連絡（#contact）が「電話：{電話番号}」の形式で表示されること（contact="tel"の場合） | 🟢 |
| M-003-09 | ご要望・ご連絡事項等（pre#comment）に入力値が表示されること | 🟢 |
| M-003-10 | ご要望・ご連絡事項等（#comment）が空欄の場合、「なし」と表示されること | 🟢 |

### M-004: 合計金額計算

| No | 項目 | 信頼性 |
|----|------|--------|
| M-004-01 | 合計金額が「基本料金 × 人数 × 宿泊数」で計算されること | 🟢 |
| M-004-02 | 土曜日または日曜日を含む宿泊では「基本料金 × 人数 × 0.25」が各日付に加算されること（週末割増） | 🟢 |
| M-004-03 | 朝食バイキング選択時に「1,000 × 人数 × 宿泊数」が加算されること | 🟢 |
| M-004-04 | 昼からチェックインプラン選択時に「1,000 × 人数」が加算されること（宿泊数に依存しない） | 🟡 |
| M-004-05 | お得な観光プラン選択時に「1,000 × 人数」が加算されること（宿泊数に依存しない） | 🟡 |
| M-004-06 | 合計金額が整数（円）で表示されること | 🟢 |

### M-005: 「この内容で予約する」ボタン

| No | 項目 | 信頼性 |
|----|------|--------|
| M-005-01 | 「この内容で予約する」ボタンが常に表示されクリック可能であること | 🟢 |
| M-005-02 | 「この内容で予約する」ボタンクリック時に予約完了モーダル（#success-modal）が表示されること | 🟢 |
| M-005-03 | モーダル表示時にフェード（fade）アニメーションが実行されること | 🟢 |

### M-006: 予約完了モーダル

| No | 項目 | 信頼性 |
|----|------|--------|
| M-006-01 | モーダルのタイトルが「予約を完了しました」であること | 🟢 |
| M-006-02 | モーダルの本文が「ご来館、心よりお待ちしております。」であること | 🟢 |
| M-006-03 | モーダルに「閉じる」ボタン（btn-success/緑色）が表示されること | 🟢 |
| M-006-04 | モーダルヘッダーに「×」クローズボタンが表示されること | 🟢 |
| M-006-05 | 「閉じる」ボタンクリック時にモーダルが閉じること | 🟢 |
| M-006-06 | 「×」ボタンクリック時にモーダルが閉じること | 🟢 |
| M-006-07 | モーダルが閉じた後に `window.close()` が実行されること | 🟢 |
| M-006-08 | モーダルクローズ後にブラウザがタブを閉じること（`window.close()` が許可された場合） | 🟡 |

### M-007: ナビゲーション

| No | 項目 | 信頼性 |
|----|------|--------|
| M-007-01 | ナビゲーションに「Hotel Planisphere」ブランドロゴが表示されること | 🟢 |

---

## Never（できてはいけない）

### N-001: 不正アクセス防止

| No | 項目 | 信頼性 |
|----|------|--------|
| N-001-01 | `transaction` Cookie が存在しない状態でページにアクセスした場合、予約データを表示できてはいけない（トップページにリダイレクト） | 🟢 |
| N-001-02 | sessionStorage に予約データが存在しない状態でページにアクセスした場合、予約データを表示できてはいけない（トップページにリダイレクト） | 🟢 |
| N-001-03 | 一度表示後にページをリロードした場合、予約データが再表示されてはいけない（データ削除済みのためリダイレクト） | 🟢 |

### N-002: モーダル操作制限

| No | 項目 | 信頼性 |
|----|------|--------|
| N-002-01 | モーダル表示中にモーダル外をクリックしてもモーダルが閉じてはいけない（data-backdrop="static"） | 🟢 |

### N-003: データ永続化禁止

| No | 項目 | 信頼性 |
|----|------|--------|
| N-003-01 | ページ表示後、予約データが sessionStorage に残ってはいけない（即座に削除） | 🟢 |
| N-003-02 | ページ表示後、`transaction` Cookie が残ってはいけない（即座に削除） | 🟢 |

---

## 信号サマリー

| 信号 | 件数 | 内容 |
|------|------|------|
| 🟢 | 31 | ページ表示4件、予約サマリー3件、詳細項目10件、合計金額4件、予約ボタン3件、モーダル6件、ナビ1件、不正アクセス防止3件、モーダル制限1件、データ削除2件 |
| 🟡 | 3 | オプション料金計算（昼からチェックインプラン・観光プランが宿泊数非依存か要確認）、window.close()ブロック時の動作 |
| 🔴 | 0 | - |
