# F-006 退会 境界値分析

## 基本情報

| 項目 | 内容 |
|------|------|
| 機能ID | F-006 |
| 機能名 | 退会 |
| 入力ファイル | 02_動作仕様.md |

---

## 境界値分析対象パラメータ

### BV-001: ユーザー種別（退会ボタンの有効/無効境界）

最も重要な境界は「プリセットユーザーか否か」という二値の境界です。

| No | パラメータ | 境界値 | 期待結果 | 信頼性 | 関連動作仕様 |
|----|-----------|--------|----------|--------|-------------|
| BV-001-01 | ユーザー種別 | 新規登録ユーザー（user.preset = false） | 退会ボタンが有効状態（操作可能） | 🟢 | M-001-03 |
| BV-001-02 | ユーザー種別 | ichiro（プリセット・プレミアム会員） | 退会ボタンがdisabled（操作不可） | 🟢 | N-001-01 |
| BV-001-03 | ユーザー種別 | sakura（プリセット・プレミアム会員） | 退会ボタンがdisabled（操作不可） | 🟢 | N-001-01 |
| BV-001-04 | ユーザー種別 | jun（プリセット・一般会員） | 退会ボタンがdisabled（操作不可） | 🟢 | N-001-01 |
| BV-001-05 | ユーザー種別 | yoshiki（プリセット・一般会員） | 退会ボタンがdisabled（操作不可） | 🟢 | N-001-01 |
| BV-001-06 | ユーザー種別 | 未ログイン | マイページへのアクセス不可（トップへリダイレクト） | 🟢 | M-005-01 |

### BV-002: 確認ダイアログの選択（OK/キャンセル境界）

ブラウザネイティブのconfirmダイアログにおける二値の選択境界です。

| No | パラメータ | 境界値 | 期待結果 | 信頼性 | 関連動作仕様 |
|----|-----------|--------|----------|--------|-------------|
| BV-002-01 | ダイアログ選択 | OK（退会を承認） | 退会処理実行（logout + removeItem + alert + 遷移） | 🟢 | M-003-01〜M-003-05 |
| BV-002-02 | ダイアログ選択 | キャンセル（退会を中止） | 退会処理非実行、マイページに留まる | 🟢 | M-004-01〜M-004-04 |

### BV-003: 退会後の状態（データ削除の境界）

退会処理後のデータ状態における境界です。

| No | パラメータ | 境界値 | 期待結果 | 信頼性 | 関連動作仕様 |
|----|-----------|--------|----------|--------|-------------|
| BV-003-01 | LocalStorageデータ | 退会前（ユーザーデータが存在する） | ユーザーデータが存在すること | 🟢 | N-003-01（退会前の逆） |
| BV-003-02 | LocalStorageデータ | 退会直後（ユーザーデータが削除された） | ユーザーデータが存在しないこと | 🟢 | N-003-01 |
| BV-003-03 | セッションクッキー | 退会前（セッションが有効） | セッションクッキーが有効であること | 🟢 | N-003-02（退会前の逆） |
| BV-003-04 | セッションクッキー | 退会直後（セッションが無効） | セッションクッキーが削除/無効化されていること | 🟢 | N-003-02 |

### BV-004: キャンセル後のデータ保持

キャンセル後はデータが保持されていることの確認境界です。

| No | パラメータ | 境界値 | 期待結果 | 信頼性 | 関連動作仕様 |
|----|-----------|--------|----------|--------|-------------|
| BV-004-01 | キャンセル後のLocalStorage | キャンセル直後 | ユーザーデータが引き続き存在すること | 🟢 | N-004-01 |
| BV-004-02 | キャンセル後のセッション | キャンセル直後 | セッションクッキーが引き続き有効であること | 🟢 | N-004-02 |

### BV-005: 退会後の再ログイン試行

退会後に同じアカウントでのログイン試行という特殊な境界です。

| No | パラメータ | 境界値 | 期待結果 | 信頼性 | 関連動作仕様 |
|----|-----------|--------|----------|--------|-------------|
| BV-005-01 | 退会済みメールアドレスでのログイン | 退会後の再ログイン試行 | ログイン失敗（アカウントデータが存在しないため） | 🟢 | N-003-03 |
| BV-005-02 | 未使用のメールアドレスでのログイン（比較） | 登録前ユーザーのログイン試行 | ログイン失敗（既存の動作と同様） | 🟡 | N-003-03 |

---

## 同値分割

### EP-001: ユーザー種別の同値クラス

| クラス | 説明 | 代表値 | 期待結果 | 信頼性 |
|--------|------|--------|----------|--------|
| 退会可能ユーザー | 新規登録ユーザー | LocalStorage登録ユーザー | 退会ボタン有効・退会処理可能 | 🟢 |
| 退会不可ユーザー（プリセット） | 事前登録テストユーザー | ichiro | 退会ボタンdisabled | 🟢 |
| アクセス不可ユーザー | 未ログイン | 未認証状態 | マイページへリダイレクト | 🟢 |

### EP-002: 確認ダイアログ選択の同値クラス

| クラス | 説明 | 代表値 | 期待結果 | 信頼性 |
|--------|------|--------|----------|--------|
| 退会承認 | OKを選択 | OK | 退会処理実行 | 🟢 |
| 退会中止 | キャンセルを選択 | キャンセル | 退会処理非実行 | 🟢 |

---

## 信号サマリー

| 信号 | 件数 | 内容 |
|------|------|------|
| 🟢 | 18 | ユーザー種別6種、ダイアログ選択2種、データ削除境界4件、キャンセル後データ保持2件、退会後ログイン1件、同値クラス5件 |
| 🟡 | 1 | 退会済みと未登録のログイン失敗の比較検証（挙動が同一かの確認） |
| 🔴 | 0 | - |

---

## 備考

- 退会機能の境界はほぼすべてが二値（OK/キャンセル、プリセット/非プリセット）であり、数値的な境界値は存在しない
- LocalStorageの削除は `localStorage.removeItem(user.email)` により確実に実行されることが実装から確認済み
- セッションクッキーの削除は `session=; max-age=0` で即時無効化
- 「退会後に再登録が可能か」という境界は本仕様書に記載なし（🟡として追記検討）
