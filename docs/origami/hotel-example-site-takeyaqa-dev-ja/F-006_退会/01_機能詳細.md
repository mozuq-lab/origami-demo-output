# F-006 退会 機能詳細

## 基本情報

| 項目 | 内容 |
|------|------|
| 機能ID | F-006 |
| 機能名 | 退会 |
| 対象ページ | mypage.html（退会処理はマイページ内で完結） |
| 入力ソース | https://hotel-example-site.takeyaqa.dev/ja/mypage.html |

---

## 機能概要

ログイン済みの新規登録ユーザーがマイページから退会処理を実行し、アカウント情報をすべて削除する機能。ブラウザのネイティブ確認ダイアログで意思確認後、セッションとLocalStorageのデータを削除してトップページへ遷移する。

---

## 利用条件

🟢 新規登録ユーザーのみ利用可能（事前登録テストユーザーには提供されない）
🟢 マイページ（mypage.html）にログイン済みでアクセスしていること
🟢 退会ボタンはプリセットユーザーに対して `disabled` 状態のためクリック不可

---

## 画面構成

### 退会ボタン（マイページ内）

🟢 マイページ下部（アイコン設定リンクの直後）に配置

| 項目 | 内容 |
|------|------|
| 表示テキスト | 退会する |
| ボタン種別 | type="submit"（フォームのサブミットボタン） |
| スタイル | Bootstrap btn-danger（赤色ボタン） |
| フォームID | delete-form |
| フォームaction | ./index.html（退会後の遷移先） |
| 初期状態（プリセットユーザー） | disabled（操作不可） |
| 新規登録ユーザー時の状態 | 有効（クリック可能） |

### 確認ダイアログ

🟢 ブラウザネイティブの `confirm()` ダイアログを使用

| 項目 | 内容 |
|------|------|
| 表示タイミング | 「退会する」ボタンクリック時 |
| 表示テキスト | 「退会すると全ての情報が削除されます。\nよろしいですか？」 |
| ボタン | OK / キャンセル |

### 完了ダイアログ

🟢 ブラウザネイティブの `alert()` ダイアログを使用

| 項目 | 内容 |
|------|------|
| 表示タイミング | 退会処理完了後（OKを選択した場合のみ） |
| 表示テキスト | 「退会処理を完了しました。ご利用ありがとうございました。」 |

---

## 動作仕様

### 退会処理フロー

🟢 以下の順序で処理が実行される:

1. ユーザーが「退会する」ボタンをクリック
2. ブラウザの `confirm()` ダイアログが表示される
3. **OKを選択した場合**:
   - `logout()` を実行（セッションクッキー削除: `session=; max-age=0`）
   - `localStorage.removeItem(user.email)` でユーザーデータを削除
   - `alert()` で完了メッセージを表示
   - フォームの `action="./index.html"` によりトップページへ遷移
4. **キャンセルを選択した場合**:
   - `return false` でフォームのサブミットをキャンセル
   - 退会処理は行われず、マイページに留まる

### データ削除の範囲

🟢 以下のデータが削除される:

| 削除対象 | 削除方法 |
|---------|---------|
| セッションクッキー（`session`） | `session=; max-age=0` で無効化 |
| LocalStorageのユーザーデータ | `localStorage.removeItem(user.email)` |

### アクセス制御

🟢 未ログイン状態でのアクセス: `redirectToTop()` によりトップページへリダイレクト
🟢 プリセットユーザーでログイン: 退会ボタンが `disabled` 状態のため操作不可

---

## 退会後の状態

🟢 退会完了後のアプリ状態:

| 項目 | 状態 |
|------|------|
| 遷移先 | トップページ（index.html） |
| ログイン状態 | 未ログイン状態（セッション削除済み） |
| ユーザーデータ | LocalStorageから削除済み |
| 再ログイン可否 | 不可（アカウントデータが削除されているため） |

---

## ユーザー種別と退会ボタン状態

🟢 ユーザー種別による退会ボタンの表示差異:

| ユーザー種別 | 退会ボタン状態 | 理由 |
|------------|-------------|------|
| 新規登録ユーザー（LocalStorage） | 有効（操作可能） | user.preset が false のため |
| ichiro（プリセット・プレミアム） | disabled | user.preset が true のため |
| sakura（プリセット・プレミアム） | disabled | user.preset が true のため |
| jun（プリセット・一般） | disabled | user.preset が true のため |
| yoshiki（プリセット・一般） | disabled | user.preset が true のため |

---

## 関連機能

| 機能 | 関係 |
|------|------|
| F-003 会員登録 | 新規登録ユーザーのみ退会が利用可能 |
| F-004 マイページ表示 | マイページ内の「退会する」ボタンから実行 |
| F-001 ログイン | 退会後は未ログイン状態になり、再ログイン不可 |

---

## 信号サマリー

| 信号 | 件数 | 内容 |
|------|------|------|
| 🟢 | 14 | 退会ボタン配置・表示テキスト・スタイル・フォーム設定、確認ダイアログ文言、完了ダイアログ文言、処理フロー全体（logout+removeItem+alert+遷移）、キャンセル時の動作、プリセットユーザー制限、未ログインリダイレクト、遷移先、削除対象データ2種、ユーザー種別5パターン |
| 🟡 | 0 | - |
| 🔴 | 0 | - |
