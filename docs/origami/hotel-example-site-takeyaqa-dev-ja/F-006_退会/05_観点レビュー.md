# 観点レビュー: F-006 退会

## 生成情報

| 項目 | 内容 |
|------|------|
| 生成日時 | 2026-02-23 |
| 入力ソース | 04_テストケース.md, 01_機能詳細.md |
| 参照カタログ | テスト観点カタログ v1.6（TIS株式会社, CC BY-SA 4.0） |
| アプリ種別 | web |
| 対象機能 | F-006 退会 |
| 総観点数 | 21件（対象: 21件 / 対象外: 0件） |
| 信号分布 | 🟢 15件 / 🟡 4件 / 🔴 2件 |

---

## カバレッジサマリー

| セクション | 対象観点数 | 🟢 カバー済 | 🟡 未カバー推奨 | 🔴 要確認 | カバー率 |
|-----------|-----------|------------|----------------|----------|---------|
| バリデーション（VAL） | 4 | 4 | 0 | 0 | 100% |
| ウェブアプリケーション（WEB） | 6 | 3 | 2 | 1 | 50% |
| セキュリティ共通（SEC-C） | 5 | 5 | 0 | 0 | 100% |
| セキュリティウェブ（SEC-W） | 3 | 1 | 1 | 1 | 33% |
| ユーザビリティ（USA） | 3 | 2 | 1 | 0 | 67% |
| **合計** | **21** | **15** | **4** | **2** | **71%** |

---

## 🟢 カバー済み観点

| # | 観点ID | 観点名 | 対応テストケース | カテゴリ |
|---|--------|--------|----------------|---------|
| 1 | VP-VAL-001 | ユーザー種別境界のバリデーション | TC-006-01（新規ユーザー有効）, TC-006-10（ichirodisabled）, TC-006-11（sakuradisabled） | バリデーション |
| 2 | VP-VAL-002 | 必須確認フローの検証 | TC-006-13（確認ダイアログ必須） | バリデーション |
| 3 | VP-VAL-003 | 有効操作の受け入れ | TC-006-01, TC-006-03（退会処理完了） | バリデーション |
| 4 | VP-VAL-004 | 無効操作の拒否 | TC-006-10（プリセットユーザー）, TC-006-11, TC-006-12（未ログインリダイレクト） | バリデーション |
| 5 | VP-WEB-001 | ページ遷移の正確性 | TC-006-03（退会後index.htmlへ遷移）, TC-006-12（未ログイン→トップへリダイレクト） | ウェブアプリ |
| 6 | VP-WEB-002 | ブラウザダイアログの動作 | TC-006-02（confirm表示）, TC-006-03（alert表示） | ウェブアプリ |
| 7 | VP-WEB-004 | フォーム送信の動作 | TC-006-03（delete-form submit→index.html遷移）, TC-006-07（キャンセル時form submit中止） | ウェブアプリ |
| 8 | VP-SEC-C-001 | アクセス制御の検証 | TC-006-10, TC-006-11（プリセットユーザー退会不可）, TC-006-12（未ログインリダイレクト） | セキュリティ共通 |
| 9 | VP-SEC-C-002 | セッション管理の適切性 | TC-006-05（退会後クッキー削除）, TC-006-09（キャンセル後クッキー保持） | セキュリティ共通 |
| 10 | VP-SEC-C-003 | データ削除の完全性 | TC-006-04（LocalStorage削除）, TC-006-05（クッキー削除） | セキュリティ共通 |
| 11 | VP-SEC-C-004 | キャンセル後のデータ保全 | TC-006-08（キャンセル後LocalStorage保持）, TC-006-09（クッキー保持） | セキュリティ共通 |
| 12 | VP-SEC-C-005 | 権限変更後の再認証 | TC-006-06（退会後同メールでログイン不可） | セキュリティ共通 |
| 13 | VP-SEC-W-001 | セッション無効化の確実性 | TC-006-05（max-age=0でのセッション無効化確認） | セキュリティウェブ |
| 14 | VP-USA-001 | 確認メッセージの明確性 | TC-006-02（「退会すると全ての情報が削除されます」メッセージ確認） | ユーザビリティ |
| 15 | VP-USA-002 | 操作取り消し機能 | TC-006-07（キャンセル選択で退会中止）, TC-006-08, TC-006-09（キャンセル後データ保持） | ユーザビリティ |

---

## 🟡 未カバー推奨観点

| # | 観点ID | 観点名 | 推奨理由 | カテゴリ |
|---|--------|--------|---------|---------|
| 1 | VP-WEB-005 | 退会後のブラウザバック操作 | 退会完了でindex.htmlへ遷移した後、ブラウザの「戻る」ボタンでマイページに戻ろうとした場合の挙動を確認すべき（キャッシュによりマイページが表示される可能性） | ウェブアプリ |
| 2 | VP-WEB-006 | ブラウザ間の確認ダイアログ表示差異 | confirm() / alert() はブラウザネイティブ実装のため、Chrome/Firefox/Safari でダイアログのUI・テキスト表示が微妙に異なる可能性がある | ウェブアプリ |
| 3 | VP-SEC-W-002 | CSRFトークンの有無の確認 | `delete-form` によるフォーム送信にCSRFトークンが実装されているかを確認すべき（実装コードからトークンの有無は不明） | セキュリティウェブ |
| 4 | VP-USA-003 | disabled状態のボタンのアクセシビリティ | プリセットユーザーに対してdisabledの退会ボタンに適切なaria属性（aria-disabled="true"等）が付与されているかを確認すべき | ユーザビリティ |

---

## 🔴 要確認観点

| # | 観点ID | 観点名 | 確認内容 | カテゴリ |
|---|--------|--------|---------|---------|
| 1 | VP-WEB-003 | ブラウザ history API との競合 | 退会フローがSPA的に動作する場合、history.pushState等と delete-form の submit が競合する可能性があるかを確認（通常のformサブミットなら問題ないが、将来的なリファクタ時のリスク） | ウェブアプリ |
| 2 | VP-SEC-W-003 | XSSペイロードのメールアドレス登録 | 退会処理では `localStorage.removeItem(user.email)` を実行するが、メールアドレス自体にXSSペイロードが含まれていた場合の影響範囲（F-003会員登録側の責務だが、退会フローでの表示箇所があれば確認必要） | セキュリティウェブ |

---

## 補完テストケース案

🟡項目に対する補完テストケース案を以下に示します。

### STC-006-01: 退会後のブラウザバックでマイページへのアクセス確認

| 項目 | 内容 |
|------|------|
| テストID | STC-006-01 |
| 対象機能 | F-006: 退会 |
| 対応観点 | VP-WEB-005 |
| テスト種別 | 異常系（ブラウザ操作） |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとして退会処理を完了済みである
- トップページ（未ログイン状態）が表示されている

**When（実行条件）:**

1. ブラウザの「戻る」ボタンをクリックしてマイページへ戻ろうとする

**Then（期待結果）:**

- [ ] マイページが表示されないこと（未ログイン状態のためトップページへリダイレクトされること）
- [ ] またはマイページのキャッシュが表示されても、操作しようとするとリダイレクトされること
- [ ] 退会済みユーザーのデータがマイページから参照できないこと

**根拠:** テスト観点カタログ VP-WEB-005（退会後のブラウザバック操作）に基づく補完

---

### STC-006-02: Firefoxでの確認ダイアログ表示確認

| 項目 | 内容 |
|------|------|
| テストID | STC-006-02 |
| 対象機能 | F-006: 退会 |
| 対応観点 | VP-WEB-006 |
| テスト種別 | ブラウザ互換性 |
| 信号 | 🟡 |

**Given（前提条件）:**

- Firefoxブラウザを使用している
- 新規登録ユーザーとしてログイン済みである
- マイページを表示している

**When（実行条件）:**

1. 「退会する」ボタンをクリックする
2. 確認ダイアログが表示されたことを確認する
3. OKを選択する

**Then（期待結果）:**

- [ ] 確認ダイアログが表示されること（Firefox固有のUIで）
- [ ] ダイアログのメッセージが正しく表示されること
- [ ] 退会処理が正常に完了すること
- [ ] トップページへ遷移すること

**根拠:** テスト観点カタログ VP-WEB-006（ブラウザ間の確認ダイアログ表示差異）に基づく補完

---

### STC-006-03: delete-formのCSRFトークン確認

| 項目 | 内容 |
|------|------|
| テストID | STC-006-03 |
| 対象機能 | F-006: 退会 |
| 対応観点 | VP-SEC-W-002 |
| テスト種別 | セキュリティ |
| 信号 | 🟡 |

**Given（前提条件）:**

- 新規登録ユーザーとしてログイン済みである
- マイページを表示している
- ブラウザのDevToolsでネットワークタブを開いている

**When（実行条件）:**

1. 「退会する」ボタンをクリックして確認ダイアログでOKを選択する
2. DevToolsでフォーム送信の内容を確認する

**Then（期待結果）:**

- [ ] フォーム送信にCSRFトークンが含まれていること（実装済みの場合）
- [ ] またはLocalStorage操作のみでサーバーへのリクエストが発生しないことを確認すること（クライアントサイドのみの実装の場合はCSRF非該当）

**根拠:** テスト観点カタログ VP-SEC-W-002（CSRFトークンの確認）に基づく補完
※ このサイトはLocalStorageベースのため、実質的にCSRFリスクは低い可能性が高い

---

### STC-006-04: disabled退会ボタンのアクセシビリティ確認

| 項目 | 内容 |
|------|------|
| テストID | STC-006-04 |
| 対象機能 | F-006: 退会 |
| 対応観点 | VP-USA-003 |
| テスト種別 | アクセシビリティ |
| 信号 | 🟡 |

**Given（前提条件）:**

- プリセットユーザー（ichiro等）としてログイン済みである
- マイページを表示している

**When（実行条件）:**

1. ブラウザのDevToolsで「退会する」ボタンの属性を確認する
2. スクリーンリーダーを使用して「退会する」ボタンにフォーカスする

**Then（期待結果）:**

- [ ] `disabled` 属性が設定されていること
- [ ] `aria-disabled="true"` または同等のアクセシビリティ属性が設定されていること（推奨）
- [ ] スクリーンリーダーがボタンを無効状態として読み上げること

**根拠:** テスト観点カタログ VP-USA-003（disabled状態のボタンのアクセシビリティ）に基づく補完

---

## 優先対応一覧

| # | 観点ID | 観点名 | 対応方針 | 信号 |
|---|--------|--------|---------|------|
| 1 | VP-WEB-005 | 退会後のブラウザバック | 補完テストケース案あり（STC-006-01）| 🟡 |
| 2 | VP-SEC-W-002 | CSRFトークン確認 | 補完テストケース案あり（STC-006-03）※LocalStorageベースなら非該当の可能性 | 🟡 |
| 3 | VP-WEB-006 | ブラウザ互換性（確認ダイアログ） | 補完テストケース案あり（STC-006-02）| 🟡 |
| 4 | VP-USA-003 | disabledボタンのアクセシビリティ | 補完テストケース案あり（STC-006-04）| 🟡 |
| 5 | VP-WEB-003 | ブラウザhistory API競合 | 🔴 ステークホルダー確認（通常のformサブミットなら低リスク） | 🔴 |
| 6 | VP-SEC-W-003 | XSSペイロードメールアドレス | 🔴 ステークホルダー確認（F-003側での入力バリデーション確認） | 🔴 |

---

## 参照カタログ情報

- **原典**: テスト観点カタログ v1.6
- **著作者**: TIS株式会社
- **ライセンス**: CC BY-SA 4.0 (Creative Commons Attribution-ShareAlike 4.0 International)
- **抽出範囲**: ブラックボックステスト関連項目（5セクション）
- **適用セクション**: VAL（バリデーション）/ WEB（ウェブアプリケーション）/ SEC-C（セキュリティ共通）/ SEC-W（セキュリティウェブ）/ USA（ユーザビリティ）

---

## 次のステップ

### 補完テストケースの反映

🟡項目の補完テストケース案を既存のテストケースに反映するには:

1. **手動追記**: `04_テストケース.md` に STC-006-01〜STC-006-04 をコピーして追記
2. **再生成**: 動作仕様（`02_動作仕様.md`）に該当観点を追加した上で `/origami:generate-cases` を再実行

### 確認事項

- 🔴項目（VP-WEB-003: history API競合、VP-SEC-W-003: XSSペイロードメール）についてステークホルダーに確認
- CSRFトークン（STC-006-03）はこのサイトがLocalStorageベースのクライアントサイド実装であるため、実質的にリスクが低い可能性が高い点を踏まえて優先度を判断
- VAL・SEC-Cセクションのカバレッジ100%は優秀。全体71%は推奨基準（70%）を上回っている
- STCを含めると85%以上のカバレッジが見込める
