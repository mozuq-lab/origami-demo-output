# F-007 プラン一覧表示 機能詳細

## 基本情報

| 項目 | 内容 |
|------|------|
| 機能ID | F-007 |
| 機能名 | プラン一覧表示 |
| 対象ページ | plans.html |
| 入力ソース | https://hotel-example-site.takeyaqa.dev/ja/plans.html |

---

## 機能概要

ログイン状態・会員ランクに応じて表示する宿泊プランを切り替える一覧表示機能。プランデータはAjaxで非同期に読み込まれる。未ログインユーザーには公開プランのみ、一般会員には会員限定プランを追加、プレミアム会員にはさらにプレミアム限定プランも表示する。

---

## 画面構成

### ページタイトル

🟢 「宿泊プラン一覧 | HOTEL PLANISPHERE - テスト自動化練習サイト」

### ナビゲーション（未ログイン時）

🟢 以下のメニュー項目が表示される:

| メニュー項目 | リンク先 |
|-------------|---------|
| ホーム | トップページ（index.html） |
| 宿泊予約 | プラン一覧ページ（plans.html）（現在ページ） |
| 会員登録 | 会員登録ページ（signup.html） |
| ログイン | ログインページ（login.html） |

### ナビゲーション（ログイン後）

🟢 ログイン後は以下のメニュー項目に変化する:

| メニュー項目 | リンク先 |
|-------------|---------|
| ホーム | トップページ（index.html） |
| 宿泊予約 | プラン一覧ページ（plans.html）（現在ページ） |
| マイページ | マイページ（mypage.html） |
| ログアウト | ログアウト処理 |

### プランカードの表示構成

🟢 各プランは以下の要素を持つカード形式で表示される:

| 要素 | 内容 |
|------|------|
| カードヘッダー | 会員限定プランのみ表示（「会員限定」または「❤️プレミアム会員限定❤️」） |
| プラン名 | `<h5>` タグで表示 |
| 大人1名料金 | 「大人1名 ¥X,XXX円」形式 |
| 最小利用人数 | 「X名様から」形式 |
| 客室タイプ | 客室名称（例：スタンダードツイン、シングル、部屋指定なし） |
| 予約ボタン | 「このプランで予約」ボタン（reserve.html へリンク） |

---

## プランデータ仕様

### 全プラン一覧（plan_data.json）

🟢 以下の10種類のプランが定義されている（id=0のプランは表示対象外):

| id | プラン名 | 料金（大人1名） | 最小人数 | 最大人数 | 最短泊数 | 最長泊数 | 客室タイプ | 表示制限 |
|----|---------|--------------|---------|---------|---------|---------|-----------|---------|
| 0 | お得な特典付きプラン | 7,000円 | 1名 | 9名 | 1泊 | 9泊 | スタンダードツイン | なし（表示なし） |
| 1 | プレミアムプラン | 10,000円 | 2名 | 9名 | 1泊 | 9泊 | プレミアムツイン | プレミアム会員限定 |
| 2 | ディナー付きプラン | 8,500円 | 1名 | 4名 | 1泊 | 3泊 | 部屋指定なし | 会員限定 |
| 3 | お得なプラン | 6,000円 | 1名 | 9名 | 1泊 | 9泊 | 部屋指定なし | 会員限定 |
| 4 | 素泊まり | 5,500円 | 1名 | 2名 | 1泊 | 9泊 | シングル | なし |
| 5 | 出張ビジネスプラン | 7,500円 | 1名 | 2名 | 1泊 | 9泊 | シングル | なし |
| 6 | エステ・マッサージプラン | 9,000円 | 1名 | 6名 | 1泊 | 9泊 | 部屋指定なし | なし |
| 7 | 貸し切り露天風呂プラン | 9,000円 | 1名 | 6名 | 1泊 | 3泊 | 部屋指定なし | なし |
| 8 | カップル限定プラン | 8,000円 | 2名 | 2名 | 1泊 | 2泊 | プレミアムツイン | なし |
| 9 | テーマパーク優待プラン | 10,000円 | 1名 | 9名 | 1泊 | 5泊 | 部屋指定なし | なし |

※ id=0「お得な特典付きプラン」はデータには存在するが、plans.js のロジックにより一覧への表示対象外（`data[i].id !== 0` の条件で除外）。

### 会員ステータス別 表示プラン

🟢 ユーザーのログイン状態・会員ランクにより表示されるプランが異なる:

| ユーザー種別 | 表示されるプラン（id） |
|------------|---------------------|
| 未ログイン | 4（素泊まり）、5（出張ビジネスプラン）、6（エステ・マッサージプラン）、7（貸し切り露天風呂プラン）、8（カップル限定プラン）、9（テーマパーク優待プラン） |
| 一般会員 | 上記6件 + 2（ディナー付きプラン）、3（お得なプラン） |
| プレミアム会員 | 上記8件 + 1（プレミアムプラン） |

- 未ログイン時：`only` フィールドが `null` のプランのみ表示
- 一般会員時：`only` が `null` または `"member"` のプランを表示
- プレミアム会員時：すべてのプランを表示（`only` が `null`、`"member"`、`"premium"` すべて）

### カードヘッダーの表示ラベル

🟢 会員限定・プレミアム会員限定プランにはカードヘッダーが付与される:

| `only` の値 | カードヘッダー表示 |
|------------|----------------|
| `null` | ヘッダーなし |
| `"member"` | 「会員限定」 |
| `"premium"` | 「❤️プレミアム会員限定❤️」 |

---

## データ読み込み仕様

### Ajax非同期読み込み

🟢 プランデータはページ読み込み時に Ajax（jQuery の `$.getJSON`）で非同期取得される:

- データ取得元URL: `{origin}/data/ja/plan_data.json?{timestamp}`
  - タイムスタンプ（`Date.now()`）をクエリパラメータに付与してキャッシュを回避する
- 取得成功後、プランカードのHTMLを生成して `#plan-list` 要素に挿入する

### Loading 表示

🟢 Ajax読み込み完了前は「Loading...」テキストが `#plan-list` 要素に表示される（デフォルト状態）。データ取得完了後にプランカードのHTMLで置き換えられる。

---

## 予約ボタン仕様

### リンク先

🟢 「このプランで予約」ボタンは以下のURLに遷移する:

```
./reserve.html?plan-id={プランid}
```

例: id=4（素泊まり）の場合 → `./reserve.html?plan-id=4`

### ボタンの動作

🟢 リンクは `target="_blank" rel="opener"` 属性付きで、新しいタブで予約ページを開く。

---

## セッション・認証仕様

### セッション管理

🟢 ログイン状態はCookieの `session` キーで管理される:

- ログイン時: `session={メールアドレス}` が Cookie にセットされる（有効期限: 630720000秒）
- ログアウト時: Cookie の `session` が削除される

### ユーザー情報取得

🟢 セッションから取得したメールアドレスをキーに、以下の順でユーザー情報を検索する:

1. プリセットユーザー（`data/ja/user.json` に定義された4名）から検索
2. 存在しない場合、LocalStorage から検索（会員登録ページで登録したユーザー）

### プリセットユーザー一覧

🟢 以下の4名のテストユーザーが事前登録されている:

| No. | メールアドレス | パスワード | ユーザー名 | 会員ランク |
|-----|--------------|-----------|-----------|-----------|
| 1 | ichiro@example.com | password | 山田一郎 | プレミアム会員 |
| 2 | sakura@example.com | pass1234 | 松本さくら | 一般会員 |
| 3 | jun@example.com | pa55w0rd! | 林潤 | プレミアム会員 |
| 4 | yoshiki@example.com | pass-pass | 木村良樹 | 一般会員 |

---

## 技術情報

| 項目 | 内容 |
|------|------|
| プランデータ取得方式 | Ajax（jQuery `$.getJSON`） |
| データ保存形式 | JSON（`/data/ja/plan_data.json`） |
| セッション保存先 | Cookie（`session` キー） |
| ユーザー情報保存先 | LocalStorage（会員登録ユーザー）/ 組み込みデータ（プリセットユーザー） |
| プランカード生成 | JavaScript でHTMLを動的生成し `#plan-list` に挿入 |
| 予約ページ遷移 | 新規タブで `reserve.html?plan-id={id}` を開く |
| レスポンシブ対応 | 🟢 Bootstrap グリッド（col-12 / col-md-6 / col-lg-4）を使用 |

---

## 関連機能

| 機能 | 関係 |
|------|------|
| F-001 ログイン | ログイン状態により表示プランが変動する |
| F-002 ログアウト | ログアウト後は未ログイン状態のプラン表示になる |
| F-003 会員登録 | 登録した一般会員アカウントでプラン表示差異を確認できる |
| F-008 宿泊予約入力 | 「このプランで予約」ボタンから遷移する |

---

## 信号サマリー

| 信号 | 件数 | 内容 |
|------|-----|------|
| 🟢 | 15 | ページタイトル、ナビゲーション（未ログイン/ログイン後）、プランカード構成、全プランデータ、会員別表示プラン、カードヘッダーラベル、Ajax読み込み、Loading表示、予約ボタンURL、予約ボタン動作、セッション管理、ユーザー情報取得、プリセットユーザー、レスポンシブ対応 |
| 🟡 | 0 | - |
| 🔴 | 0 | - |
